#ifndef AB_LCD_H
#define AB_LCD_H

#include <Arduino.h>
#include <vector>
#include <string.h>


struct DataFields {
     //--------1
    bool is4G;
    bool isSensor;
    bool isServer; 
    bool isRFID;
    bool isTemp; 
    bool isGPS;
    //--------2
    String Username;
    String Flight;
    String STD;
    String Bay;
    String ETD;
    String Gate;
    String Job;
    
    //-------3
    uint8_t maxJob =0;
    uint8_t currentJob =0;
};
class SerialLCD {
  private:
    byte badValue = 0x00;
    byte goodValue = 0x01;
    //------------- 0
    byte pageCheck[6] = { 0xA5, 0x5A, 0x03, 0x81, 0x03, 0x02 };
    byte resetLCD[7] = {0xA5, 0x5A, 0x04, 0x80, 0xEE, 0x5A, 0xA5};

    //------------- 1
    byte check4G[8] = { 0xA5, 0x5A, 0x05, 0x82, 0x02, 0x01, 0x00, 0x00};
    byte checkSensors[8] = { 0xA5, 0x5A, 0x05, 0x82, 0x02, 0x02, 0x00, 0x00};
    byte checkSever[8] = { 0xA5, 0x5A, 0x05, 0x82, 0x02, 0x03, 0x00, 0x00};
    byte checkRFID[8] = { 0xA5, 0x5A, 0x05, 0x82, 0x02, 0x04, 0x00, 0x00};
    byte chekTemp[8] = { 0xA5, 0x5A, 0x05, 0x82, 0x02, 0x05, 0x00, 0x00};
    byte checkGPS[8] = { 0xA5, 0x5A, 0x05, 0x82, 0x02, 0x06, 0x00, 0x00};

    //------------- 2
    byte showPopUp[6] = { 0xA5, 0x5A, 0x03, 0x80, 0x4F, 0x01};
    byte HidePopUp[6] = { 0xA5, 0x5A, 0x03, 0x80, 0x4F, 0x02};

    //------------- 3
    byte b_logOut0[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x50, 0x01, 0x00, 0x00};

    //------------- 4
    byte b_logOut1[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x51, 0x01, 0x00, 0x00};
    byte b_job[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x55, 0x01, 0x00, 0x00};
    byte speakerBeep[6] = { 0xA5, 0x5A, 0x03, 0x80, 0x02, 0x0D};
    byte h_setJobNumber[6] = { 0xA5, 0x5A, 0x04, 0x82, 0x02, 0x50};
    
    //------------- 6
    byte b_logOut2[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x52, 0x01, 0x00, 0x00};
    byte b_left[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x60, 0x01, 0x00, 0x00};
    byte b_right[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x65, 0x01, 0x00, 0x00};
    byte b_yes[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x70, 0x01, 0x00, 0x00};
    byte b_no[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x75, 0x01, 0x00, 0x00};
    byte h_setUser[6] = { 0xA5, 0x5A, 0x07, 0x82, 0x03, 0x00};
    byte h_setFlight[6] = { 0xA5, 0x5A, 0x07, 0x82, 0x04, 0x00};
    byte h_setSTD[6] = { 0xA5, 0x5A, 0x07, 0x82, 0x05, 0x00};
    byte h_setBay[6] = { 0xA5, 0x5A, 0x07, 0x82, 0x06, 0x00};
    byte h_setETD[6] = { 0xA5, 0x5A, 0x07, 0x82, 0x07, 0x00};
    byte h_setGate[6] = { 0xA5, 0x5A, 0x07, 0x82, 0x08, 0x00};
    byte h_setJob[6] = { 0xA5, 0x5A, 0x07, 0x82, 0x09, 0x00};

    //------------- 8
    byte b_logOut3[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x53, 0x01, 0x00, 0x00};
    byte b_finish1[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x80, 0x01, 0x00, 0x00};
    byte b_cancel1[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x85, 0x01, 0x00, 0x00};

    // ------------- 11
    byte b_confrim[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x90, 0x01, 0x00, 0x00};
    byte b_cancel2[9] = { 0xA5, 0x5A, 0x06, 0x83, 0x00, 0x95, 0x01, 0x00, 0x00};

    bool checkPage(byte receivedData[]);
    bool checkReceivedData(byte receivedData[], size_t expectedDataSize);
    bool isEmpty(byte data[], size_t size);
    void changeLastHexValue(byte array[], size_t arraySize, byte lastValue);
    void clearReceivedData();
    byte* stringToByteArray(const String& str, size_t arraySize);
    byte* combineArrays(byte* byteArray, size_t byteArraySize, byte staticArray[], size_t staticArraySize); 
    void updateLCDObject(String str, byte code[],size_t size);
    void clearLCDObject(int maxLength, byte code[], size_t size); 
    uint8_t maxContentLength =10;
    uint8_t h_Length =6;
    DataFields previous;
    bool popupSent = false;
    void clearLogOutData();
    void prepareDataPage4();
    void prepareDataPage6(); 
  public:
    byte pageSelector[7] = { 0xA5, 0x5A, 0x04, 0x80, 0x03, 0x00, 0x00 };
    void sendData(byte data[], size_t dataSize);
    void addDataToByteArray(std::vector<byte>& byteArray, const String& data);
    void page0();
    void page1();
    void page2();
    void page3();
    void page4();
    void page6();
    void page8();
    void page11();
    void selectPage(int page);
    void listentoLCD();
    unsigned long startTime = 0;
    unsigned long duration;
    bool readRFID;
    byte receivedData[9];
    DataFields current;

};

#endif
